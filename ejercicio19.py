# -*- coding: utf-8 -*-
"""Ejercicio19

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1xAEBIQtxTDPB1H7R1kOQpCuAPnmT6eAY
"""

# ğŸ“š LibrerÃ­as
import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.tsa.stattools import adfuller, kpss
from google.colab import files
import re

# ğŸ”¼ Subir archivo .txt
uploaded = files.upload()
filename = list(uploaded.keys())[0]

# ğŸ“„ Leer y limpiar archivo
with open(filename, "r") as file:
    lines = file.readlines()

data_lines = [line.strip() for line in lines if re.match(r'^\d{4}:\d{2}', line)]

records = []
for line in data_lines:
    parts = re.split(r'\s+', line)
    if len(parts) >= 3:
        date_str = parts[0]
        gs3m = float(parts[1])
        gs6m = float(parts[2])
        records.append([date_str, gs3m, gs6m])

df = pd.DataFrame(records, columns=["Date", "GS3M", "GS6M"])
df["Date"] = pd.to_datetime(df["Date"], format="%Y:%m")
df.set_index("Date", inplace=True)

# ğŸ“Š Graficar ambas series
plt.figure(figsize=(12, 5))
plt.plot(df["GS3M"], label="Tasa 3 meses (GS3M)", linewidth=2)
plt.plot(df["GS6M"], label="Tasa 6 meses (GS6M)", linewidth=2)
plt.title("Tasas de Bonos del Tesoro: 3 vs 6 meses")
plt.xlabel("Fecha")
plt.ylabel("Tasa (%)")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()

# ğŸ“‰ FunciÃ³n para pruebas de estacionariedad
def test_stationarity(series, name="Serie"):
    print(f"ğŸ” Resultados para {name}:")
    adf_result = adfuller(series)
    print(f"ADF p-value: {adf_result[1]:.4f} â†’ {'Estacionaria' if adf_result[1] < 0.05 else 'No estacionaria'}")
    kpss_result = kpss(series, regression='c', nlags="auto")
    print(f"KPSS p-value: {kpss_result[1]:.4f} â†’ {'Estacionaria' if kpss_result[1] >= 0.05 else 'No estacionaria'}")
    print("-" * 60)

# âœ… Aplicar pruebas a ambas series
test_stationarity(df["GS3M"], "GS3M (Tasa 3 meses)")
test_stationarity(df["GS6M"], "GS6M (Tasa 6 meses)")

# ğŸ“‰ Diferenciar las series
df["GS3M_diff"] = df["GS3M"].diff()
df["GS6M_diff"] = df["GS6M"].diff()

# ğŸ§ª Volver a probar estacionariedad sobre las series diferenciadas
print("ğŸ” Serie diferenciada: GS3M (3 meses)")
test_stationarity(df["GS3M_diff"].dropna(), "GS3M_diff (Primera diferencia)")

print("\nğŸ” Serie diferenciada: GS6M (6 meses)")
test_stationarity(df["GS6M_diff"].dropna(), "GS6M_diff (Primera diferencia)")

# ğŸ“¦ Importar prueba de cointegraciÃ³n de Johansen
from statsmodels.tsa.vector_ar.vecm import coint_johansen

# ğŸ“‹ Crear dataframe con ambas series (nivel, no diferencias)
df_coint = df[["GS3M", "GS6M"]].dropna()

# ğŸ§ª Prueba de cointegraciÃ³n de Johansen (con tendencia y 1 lag mÃ­nimo)
result = coint_johansen(df_coint, det_order=0, k_ar_diff=1)

# ğŸ“ˆ Mostrar estadÃ­sticos de traza y valores crÃ­ticos
print("ğŸ” EstadÃ­sticos de traza de Johansen:")
for i, trace in enumerate(result.lr1):
    print(f"Rango â‰¤ {i}: estadÃ­stico = {trace:.4f}, crÃ­tico (5%) = {result.cvt[i, 1]:.4f} â†’ {'âœ”ï¸ Cointegrado' if trace > result.cvt[i, 1] else 'âŒ No'}")

from statsmodels.tsa.vector_ar.vecm import VECM

# ğŸ§ª Crear dataframe con series en niveles (cointegradas)
df_coint = df[["GS3M", "GS6M"]].dropna()

# ğŸ”¢ Ajustar modelo VECM con 4 rezagos (k_ar_diff=3 â†’ 4 niveles porque VECM usa d+1)
vecm_model = VECM(df_coint, k_ar_diff=3, coint_rank=1, deterministic="co")
vecm_result = vecm_model.fit()

# ğŸ“‹ Resumen del modelo
print(vecm_result.summary())